import discord
import re
import asyncio
from datetime import datetime

TOKEN = "SEM_DEJ_SV콡J_TOKEN"
CHANNEL_ID = 123456789012345678  # ID kan치lu, kam bude pos칤lat 쬰b콏칤캜ek

intents = discord.Intents.default()
intents.message_content = True
intents.messages = True

client = discord.Client(intents=intents)

scores = {}  # {u쬴vatel: 캜칤slo}

async def reset_scores():
    """Ka쬯칳 m캩s칤c sma쬰 sk칩re."""
    while True:
        now = datetime.now()
        if now.day == 1 and now.hour == 0 and now.minute == 0:
            scores.clear()
            print("游늰 Sk칩re resetov치no")
            channel = client.get_channel(CHANNEL_ID)
            if channel:
                await channel.send("游댃 M캩s칤캜n칤 reset 쬰b콏칤캜ku!")
        await asyncio.sleep(60)

def generate_leaderboard():
    sorted_scores = sorted(scores.items(), key=lambda x: x[1], reverse=True)
    lines = [f"{i+1}. {user} - {score}" for i, (user, score) in enumerate(sorted_scores)]
    return "\n".join(lines) if lines else "콯치dn치 data."

@client.event
async def on_ready():
    print(f"P콏ihl치코en jako {client.user}")
    client.loop.create_task(reset_scores())

@client.event
async def on_message(message):
    if message.author.bot:
        return

    # Najdi prvn칤 캜칤slo ve zpr치v캩
    match = re.search(r"\d+", message.content)
    if match:
        number = int(match.group())
        scores[str(message.author)] = number

        # Po코li/aktualizuj 쬰b콏칤캜ek
        channel = client.get_channel(CHANNEL_ID)
        if channel:
            await channel.send(f"游늵 **Aktu치ln칤 쬰b콏칤캜ek:**\n{generate_leaderboard()}")

client.run(TOKEN)
